---
layout: post
title: PS4 Controller and ROS
description: 'How to configure the PS4 controller to work with your ROS-based robot'
date: '2020-04-05T09:46:00.000-04:00'
author: Michael Ferguson
tags:
- ros
- national-robotics-week
- maxwell
- robots
modified_time: '2020-04-05T09:56:55.006-04:00'
blogger_id: tag:blogger.com,1999:blog-8995060597167955455.post-2014848528425086828
blogger_orig_url: http://www.showusyoursensors.com/2020/04/ps4-controller-and-ros.html
redirect_from: "/2020/04/ps4-controller-and-ros.html"
---

<i>It's National Robotics Week! But you should definitely #StayAtHome, so there are
no in-person events this week. I already had this (and several other posts) nearly
done, so I'm aiming to post something every day this week.</i><br />
<br />
Recently I updated Maxwell to use the PS4 controller. It is not the easiest thing to
setup, and I found lots of misinformation out there that either never worked, or no
longer works. So here is how I now setup PS4 controllers on Ubuntu Bionic (18.04).<br />
<br />
These instructions require no special packages to be installed, we're using the default
bluetooth built into the Linux kernel, which should also mean that other bluetooth
stuff continues to work (unlike the older ps3_joy ROS package).<br />
<br />
To pair the PS4 controller with the robot computer we need to start the controller in
"pairing mode". Hold down the SHARE button while pushing the POWER button. Continue
to hold both buttons until the LED starts flashing very quickly.<br />
<br />
On the computer we will use <i>bluetoothctl</i> to do three things:<br />
<br />
<ul>
<li>Turn on the scan - so we can find new devices. This is how we find the MAC address
of the wireless controller.</li>
<li>Tell the bluetooth controller to trust the wireless controller</li>
<li>Tell the bluetooth controller to pair with the wireless controller</li>
</ul>

Open a terminal on the robot computer and run the following commands that are in
<span style="color: red;">RED</span>. Replace the MAC address with the actual device found
(I've highlighted in green what the line should look like):<br />
<br />
<table style="border-collapse: collapse; border: none; table-layout: fixed; width: 468pt;"><colgroup><col></col></colgroup><tbody><tr style="height: 0pt;"><td style="background-color: #fff2cc; overflow-wrap: break-word; overflow: hidden; padding: 5pt; vertical-align: top;"><div dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="background-color: transparent; color: black; font-family: &quot;courier new&quot;; font-size: 11pt; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">$ </span><span style="background-color: transparent; color: red; font-family: &quot;courier new&quot;; font-size: 11pt; font-style: normal; font-weight: 700; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">sudo bluetoothctl</span></div><div dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="background-color: transparent; color: black; font-family: &quot;courier new&quot;; font-size: 11pt; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">[</span><span style="background-color: transparent; color: #93c47d; font-family: &quot;courier new&quot;; font-size: 11pt; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">NEW</span><span style="background-color: transparent; color: black; font-family: &quot;courier new&quot;; font-size: 11pt; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">] Controller A0:A4:C5:CC:D1:92 velocityXYZ [default]</span></div><div dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="background-color: transparent; color: black; font-family: &quot;courier new&quot;; font-size: 11pt; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">Agent registered</span></div><div dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="background-color: transparent; color: #4a86e8; font-family: &quot;courier new&quot;; font-size: 11pt; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">[bluetooth]</span><span style="background-color: transparent; color: black; font-family: &quot;courier new&quot;; font-size: 11pt; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"># </span><span style="background-color: transparent; color: red; font-family: &quot;courier new&quot;; font-size: 11pt; font-style: normal; font-weight: 700; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">scan on</span></div><div dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="background-color: transparent; color: black; font-family: &quot;courier new&quot;; font-size: 11pt; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">Discovery started</span></div><div dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="background-color: transparent; color: black; font-family: &quot;courier new&quot;; font-size: 11pt; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">[</span><span style="background-color: transparent; color: #ff9900; font-family: &quot;courier new&quot;; font-size: 11pt; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">CHG</span><span style="background-color: transparent; color: black; font-family: &quot;courier new&quot;; font-size: 11pt; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">] Controller A0:A4:C5:CC:D1:92 Discovering: yes</span></div><div dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="background-color: transparent; color: black; font-family: &quot;courier new&quot;; font-size: 11pt; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">[</span><span style="background-color: transparent; color: #93c47d; font-family: &quot;courier new&quot;; font-size: 11pt; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">NEW</span><span style="background-color: transparent; color: black; font-family: &quot;courier new&quot;; font-size: 11pt; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">] Device </span><span style="background-color: lime; color: black; font-family: &quot;courier new&quot;; font-size: 11pt; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">A4:AE:11:02:78:BC</span><span style="background-color: transparent; color: black; font-family: &quot;courier new&quot;; font-size: 11pt; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> Wireless Controller</span></div><div dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="background-color: transparent; color: #4a86e8; font-family: &quot;courier new&quot;; font-size: 11pt; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">[bluetooth]</span><span style="background-color: transparent; color: black; font-family: &quot;courier new&quot;; font-size: 11pt; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"># </span><span style="background-color: transparent; color: red; font-family: &quot;courier new&quot;; font-size: 11pt; font-style: normal; font-weight: 700; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">trust A4:AE:11:02:78:BC</span></div><div dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="background-color: transparent; color: black; font-family: &quot;courier new&quot;; font-size: 11pt; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">Changing A4:AE:11:02:78:BC trust succeeded</span></div><div dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="background-color: transparent; color: #4a86e8; font-family: &quot;courier new&quot;; font-size: 11pt; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">[bluetooth]</span><span style="background-color: transparent; color: black; font-family: &quot;courier new&quot;; font-size: 11pt; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"># </span><span style="background-color: transparent; color: red; font-family: &quot;courier new&quot;; font-size: 11pt; font-style: normal; font-weight: 700; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">pair A4:AE:11:02:78:BC</span></div><div dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="background-color: transparent; color: black; font-family: &quot;courier new&quot;; font-size: 11pt; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">Attempting to pair with A4:AE:11:02:78:BC</span></div><div dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="background-color: transparent; color: black; font-family: &quot;courier new&quot;; font-size: 11pt; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">[</span><span style="background-color: transparent; color: #ff9900; font-family: &quot;courier new&quot;; font-size: 11pt; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">CHG</span><span style="background-color: transparent; color: black; font-family: &quot;courier new&quot;; font-size: 11pt; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">] Device A4:AE:11:02:78:BC Connected: yes</span></div><div dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="background-color: transparent; color: black; font-family: &quot;courier new&quot;; font-size: 11pt; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">[</span><span style="background-color: transparent; color: #ff9900; font-family: &quot;courier new&quot;; font-size: 11pt; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">CHG</span><span style="background-color: transparent; color: black; font-family: &quot;courier new&quot;; font-size: 11pt; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">] Device A4:AE:11:02:78:BC UUIDs: 00001124-0000-1000-8000-00805f9b34fb</span></div><div dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="background-color: transparent; color: black; font-family: &quot;courier new&quot;; font-size: 11pt; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">[</span><span style="background-color: transparent; color: #ff9900; font-family: &quot;courier new&quot;; font-size: 11pt; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">CHG</span><span style="background-color: transparent; color: black; font-family: &quot;courier new&quot;; font-size: 11pt; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">] Device A4:AE:11:02:78:BC UUIDs: 00001200-0000-1000-8000-00805f9b34fb</span></div><div dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="background-color: transparent; color: black; font-family: &quot;courier new&quot;; font-size: 11pt; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">[</span><span style="background-color: transparent; color: #ff9900; font-family: &quot;courier new&quot;; font-size: 11pt; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">CHG</span><span style="background-color: transparent; color: black; font-family: &quot;courier new&quot;; font-size: 11pt; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">] Device A4:AE:11:02:78:BC ServicesResolved: yes</span></div><div dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="background-color: transparent; color: black; font-family: &quot;courier new&quot;; font-size: 11pt; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">[</span><span style="background-color: transparent; color: #ff9900; font-family: &quot;courier new&quot;; font-size: 11pt; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">CHG</span><span style="background-color: transparent; color: black; font-family: &quot;courier new&quot;; font-size: 11pt; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">] Device A4:AE:11:02:78:BC Paired: yes</span></div><div dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="background-color: transparent; color: black; font-family: &quot;courier new&quot;; font-size: 11pt; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">Pairing successful</span></div><div dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="background-color: transparent; color: #4a86e8; font-family: &quot;courier new&quot;; font-size: 11pt; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">[bluetooth]</span><span style="background-color: transparent; color: black; font-family: &quot;courier new&quot;; font-size: 11pt; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"># </span><span style="background-color: transparent; color: red; font-family: &quot;courier new&quot;; font-size: 11pt; font-style: normal; font-weight: 700; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">exit</span></div></td></tr></tbody></table>

When complete, the PS4 LED should go solid and turn a deeper blue color. You should only have to
do this once, and the controller will remain paired until you pair it with another computer.<br />
<br />
Once you've got the PS4 controller paired, you'll find out the button mapping is just a little different
form the PS3:<br />
<br />
<ul>
<li>The common "deadman" button on the upper corner of the joystick (labeled "L1") is index 4
instead of 10.</li>
<li>The joystick axis have changed a bit, I had to change axis_linear from 4 to 3.</li>
<li>It is probably a good idea to set the <i>autorepeat_rate</i> on the joy node. This prevents
stuttering publishing (and movement).</li>
</ul>

Here's the <a href="https://github.com/mikeferguson/maxwell/commit/f6e107fc560f9510c7e84a90c2c49f280a71460c#diff-f8f2bfe78b5b42fb49e8190bb44b4a5a">changes</a>
I made to Maxwell to update from the PS3 to the PS4 controller. I use a custom node for converting
Joy messages into Twist messages. If you're using the popular <i>teleop_twist_joy</i> package,
you'll be using <i>enable_button</i> parameter instead of <i>axis_deadman</i>.
